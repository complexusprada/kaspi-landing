---
interface Props {
  lang: 'ru' | 'kk';
  compact?: boolean;
}

const { lang, compact = false } = Astro.props;

const t = {
  ru: {
    nav: {
      dashboard: 'Дашборд',
      merchants: 'Продавцы',
      products: 'Товары',
      billing: 'Биллинг',
    },
    support: 'Поддержка',
    table: {
      sku: 'SKU',
      city: 'Город',
      leader: 'Лидер',
      current: 'Текущая цена',
      top: 'Топ цена',
    },
    you: 'Вы',
    products: 'Товары',
    totalProducts: '847 товаров',
    botsActive: '3 бота активны',
    cities: ['Алматы', 'Астана', 'Шымкент', 'Караганда'],
    updating: 'Обновление цены...',
    updated: 'Цена обновлена!',
  },
  kk: {
    nav: {
      dashboard: 'Басқару тақтасы',
      merchants: 'Сатушылар',
      products: 'Тауарлар',
      billing: 'Биллинг',
    },
    support: 'Қолдау',
    table: {
      sku: 'SKU',
      city: 'Қала',
      leader: 'Лидер',
      current: 'Ағымдағы баға',
      top: 'Топ баға',
    },
    you: 'Сіз',
    products: 'Тауарлар',
    totalProducts: '847 тауар',
    botsActive: '3 бот белсенді',
    cities: ['Алматы', 'Астана', 'Шымкент', 'Қарағанды'],
    updating: 'Баға жаңартылуда...',
    updated: 'Баға жаңартылды!',
  },
}[lang];

const products = [
  { sku: '100847291', city: 0, current: '49 900', top: '50 000' },
  { sku: '100523847', city: 1, current: '92 500', top: '91 000' },
  { sku: '100912384', city: 0, current: '24 990', top: '25 500' },
  { sku: '100384756', city: 2, current: '167 000', top: '165 000' },
  { sku: '100629183', city: 3, current: '34 500', top: '35 000' },
];
---

<!-- Demo Browser Window -->
<div class="demo-container">
  <div class="rounded-2xl border-2 bg-card shadow-2xl overflow-hidden">
    <!-- Browser Header -->
    <div class="bg-muted/50 px-6 py-3 border-b flex items-center gap-3">
      <div class="flex gap-2">
        <div class="w-3.5 h-3.5 rounded-full bg-red-500"></div>
        <div class="w-3.5 h-3.5 rounded-full bg-yellow-500"></div>
        <div class="w-3.5 h-3.5 rounded-full bg-green-500"></div>
      </div>
      <div class="flex-1 flex justify-center">
        <div class="bg-background rounded-lg px-6 py-2 text-sm text-muted-foreground flex items-center gap-2">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
          app.kaspirace.kz/products
        </div>
      </div>
    </div>

    <!-- App Layout -->
    <div class="flex bg-background">
      <!-- Sidebar -->
      <div class="w-64 border-r bg-card hidden md:block">
        <!-- Logo -->
        <div class="p-5 border-b flex items-center justify-between">
          <div class="flex items-center gap-3">
            <svg width="36" height="36" viewBox="0 0 48 48" fill="none">
              <path d="M8 32C8 20.954 16.954 12 28 12" stroke="#D52027" stroke-width="4" stroke-linecap="round" fill="none" />
              <path d="M12 36C12 24.954 19.954 16 32 16" stroke="#D52027" stroke-width="3" stroke-linecap="round" fill="none" opacity="0.4" />
              <line x1="24" y1="28" x2="38" y2="16" stroke="#D52027" stroke-width="3" stroke-linecap="round" />
              <circle cx="24" cy="28" r="4" fill="#D52027" />
            </svg>
            <span class="font-black text-base">
              <span class="text-[#D52027]">KASPI</span><span class="text-foreground">RACE</span>
            </span>
          </div>
        </div>

        <!-- Navigation -->
        <div class="p-4">
          <nav class="space-y-1">
            <a class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm text-muted-foreground hover:bg-muted">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="9"></rect>
                <rect x="14" y="3" width="7" height="5"></rect>
                <rect x="14" y="12" width="7" height="9"></rect>
                <rect x="3" y="16" width="7" height="5"></rect>
              </svg>
              {t.nav.dashboard}
            </a>
            <a class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm text-muted-foreground hover:bg-muted">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              </svg>
              {t.nav.merchants}
              <span class="ml-auto text-xs bg-muted px-2 py-1 rounded">2</span>
            </a>
            <a class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm bg-primary/10 text-primary font-medium">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
              </svg>
              {t.nav.products}
              <span class="ml-auto text-xs bg-primary text-primary-foreground px-2 py-1 rounded">847</span>
            </a>
            <a class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm text-muted-foreground hover:bg-muted">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                <line x1="1" y1="10" x2="23" y2="10"></line>
              </svg>
              {t.nav.billing}
            </a>
          </nav>
        </div>
      </div>

      <!-- Main Content -->
      <div class="flex-1 p-6 min-w-0">
        <!-- Page Header -->
        <div class="mb-6 flex items-center justify-between">
          <div>
            <h1 class="text-xl font-semibold">{t.products}</h1>
            <p class="text-sm text-muted-foreground">{t.totalProducts}</p>
          </div>
          <div class="flex items-center gap-2 px-4 py-2 rounded-full bg-green-500/10 text-green-600 text-sm font-medium">
            <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
            {t.botsActive}
          </div>
        </div>

        <!-- Products Table -->
        <div class="border rounded-xl overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead class="bg-muted/50 border-b">
                <tr>
                  <th class="px-4 py-4 text-left font-medium text-muted-foreground">{t.table.sku}</th>
                  <th class="px-4 py-4 text-left font-medium text-muted-foreground hidden sm:table-cell">{t.table.city}</th>
                  <th class="px-4 py-4 text-center font-medium text-muted-foreground">{t.table.leader}</th>
                  <th class="px-4 py-4 text-right font-medium text-muted-foreground">{t.table.current}</th>
                  <th class="px-4 py-4 text-right font-medium text-muted-foreground hidden md:table-cell">{t.table.top}</th>
                </tr>
              </thead>
              <tbody>
                {products.map((product, index) => (
                  <tr
                    class:list={[
                      'border-b transition-colors duration-500',
                      index === 0 ? 'demo-row-highlight' : ''
                    ]}
                  >
                    <td class="px-4 py-4 font-mono text-sm">{product.sku}</td>
                    <td class="px-4 py-4 hidden sm:table-cell">{t.cities[product.city]}</td>
                    <td class="px-4 py-4 text-center">
                      {index === 0 ? (
                        <span class="demo-leader-badge inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-600 text-white">
                          {t.you}
                        </span>
                      ) : (
                        <svg class="w-5 h-5 text-muted-foreground/30 mx-auto" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <line x1="18" y1="6" x2="6" y2="18"></line>
                          <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                      )}
                    </td>
                    <td class="px-4 py-4 text-right">
                      <span class:list={['font-semibold', index === 0 ? 'demo-price text-green-600' : '']}>
                        {product.current} ₸
                      </span>
                    </td>
                    <td class="px-4 py-4 text-right hidden md:table-cell text-muted-foreground demo-top-price">
                      {product.top} ₸
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>

        <!-- Status bar -->
        <div class="mt-6 flex items-center justify-center gap-3 text-sm text-muted-foreground">
          <span class="demo-status-text">{t.updating}</span>
          <div class="flex items-center gap-1">
            <div class="w-2 h-2 rounded-full bg-primary animate-bounce" style="animation-delay: 0ms"></div>
            <div class="w-2 h-2 rounded-full bg-primary animate-bounce" style="animation-delay: 150ms"></div>
            <div class="w-2 h-2 rounded-full bg-primary animate-bounce" style="animation-delay: 300ms"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<style>
  .demo-row-highlight {
    animation: rowHighlight 6s ease-in-out infinite;
  }

  @keyframes rowHighlight {
    0%, 20% { background-color: transparent; }
    30%, 90% { background-color: rgb(34 197 94 / 0.1); }
    100% { background-color: transparent; }
  }

  .demo-leader-badge {
    animation: leaderBadge 6s ease-in-out infinite;
  }

  @keyframes leaderBadge {
    0%, 20% { opacity: 0; transform: scale(0.8); }
    30%, 90% { opacity: 1; transform: scale(1); }
    100% { opacity: 0; transform: scale(0.8); }
  }

  .demo-price {
    animation: priceChange 6s ease-in-out infinite;
  }

  @keyframes priceChange {
    0%, 20% { color: hsl(var(--foreground)); }
    25% { color: rgb(34 197 94); text-shadow: 0 0 8px rgb(34 197 94 / 0.5); }
    30%, 90% { color: rgb(34 197 94); text-shadow: none; }
    100% { color: hsl(var(--foreground)); }
  }

  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-4px); }
  }

  .animate-bounce {
    animation: bounce 0.6s ease-in-out infinite;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const priceElement = document.querySelector('.demo-price');
    const topPriceElement = document.querySelector('.demo-top-price');
    const statusText = document.querySelector('.demo-status-text');

    if (!priceElement || !topPriceElement) return;

    const states = [
      { price: '50 100 ₸', topPrice: '50 000 ₸', status: 'Обнаружена новая цена конкурента...' },
      { price: '50 100 ₸', topPrice: '49 950 ₸', status: 'Конкурент снизил цену!' },
      { price: '49 900 ₸', topPrice: '49 950 ₸', status: 'Автоматическое снижение цены...' },
      { price: '49 900 ₸', topPrice: '49 950 ₸', status: 'Вы снова лидер!' },
      { price: '49 900 ₸', topPrice: '49 950 ₸', status: 'Мониторинг продолжается...' },
    ];

    let currentState = 0;

    function updateState() {
      const state = states[currentState];
      priceElement.textContent = state.price;
      topPriceElement.textContent = state.topPrice;
      if (statusText) statusText.textContent = state.status;
      currentState = (currentState + 1) % states.length;
    }

    setInterval(updateState, 1200);
  });
</script>
